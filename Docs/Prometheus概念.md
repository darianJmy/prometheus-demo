# Prometheus 入门
所有文档抄袭于prometheus官网，编写只是用于加深个人记忆与理解。
[https://prometheus.io/](https://prometheus.io/)
## 概述
### 什么是普罗米修斯？
Prometheus是一个开源系统监控和警报工具包，最初在 SoundCloud构建。自 2012 年成立以来，许多公司和组织都采用了 Prometheus，该项目拥有非常活跃的开发者和用户社区。它现在是一个独立的开源项目，独立于任何公司维护。为了强调这一点，并明确项目的治理结构，Prometheus 于 2016 年加入 云原生计算基金会，成为继Kubernetes之后的第二个托管项目。

Prometheus 将其指标收集并存储为时间序列数据，即指标信息与记录时的时间戳以及称为标签的可选键值对一起存储。

**特征**
普罗米修斯的主要特点是：

* 具有由度量名称和键/值对标识的时间序列数据的多维数据模型
* PromQL，一种利用这种维度的灵活查询语言
* 不依赖分布式存储；单个服务器节点是自治的
* 时间序列收集通过 HTTP 上的拉模型进行
* 通过中间网关支持推送时间序列
* 通过服务发现或静态配置发现目标
* 多种图形模式和仪表板支持

**什么是指标？**

用外行的话来说，指标是数字度量。时间序列意味着随着时间的推移记录变化。用户想要测量的内容因应用程序而异。对于 Web 服务器，它可能是请求时间，对于数据库，它可能是活动连接数或活动查询数等。

指标在理解为什么您的应用程序以某种方式工作方面起着重要作用。假设您正在运行一个 Web 应用程序并发现该应用程序很慢。您将需要一些信息来了解您的应用程序发生了什么。例如，当请求数量很高时，应用程序可能会变慢。如果您有请求计数指标，您可以找出原因并增加服务器数量来处理负载。

**成分**

Prometheus 生态系统由多个组件组成，其中许多是可选的：

* 主要的Prometheus 服务器，用于抓取和存储时间序列数据
* 用于检测应用程序代码的客户端库
* 支持短期工作的推送网关
* HAProxy、StatsD、Graphite 等服务的专用exporter。
* 处理警报的警报管理器
* 各种支持工具
* 大多数 Prometheus 组件都是用Go编写的，这使得它们易于构建和部署为静态二进制文件。

**架构**
![avatar](https://github.com/darianJmy/prometheus-demo/blob/main/Photos/architecture.png)

* Promtheus server 可以通过静态文件或动态发现获取需要监控的目标机器。
* prometheus获取指标是默认 pull 模式，就是 server 主动去目标节点获取 http 模式页面指标，但是也可以通过 Pushgateway 插件使用 push 模式，Pushgateway 主动把数据推送给 server。 
* server 可以配置告警规则，一旦触发告警。就会主动把告警信息推送给 Alertmanager，Alertmanager 是专门处理告警的工具，它可以在接收到告警后往邮件或者企业微信或者webhook发送信息。
* 如果想展示在Web页面，可以使用插件如 Grafana 主动调用 server 接口，使用 PromQL 语句查询数据。
* Server 的数据是存储在本地文件中的，但最终是通过时许数据库读取文件中数据。

**什么时候合适？**
Prometheus 可以很好地记录任何纯数字时间序列。它既适合以机器为中心的监控，也适合监控高度动态的面向服务的架构。在微服务的世界中，它对多维数据收集和查询的支持是一个特殊的优势。

Prometheus 是为可靠性而设计的，它是您在停电期间可以使用的系统，可让您快速诊断问题。每个 Prometheus 服务器都是独立的，不依赖于网络存储或其他远程服务。当您的基础设施的其他部分损坏时，您可以依赖它，并且您无需设置大量基础设施即可使用它。

**什么时候不合适？**
Prometheus 重视可靠性。即使在故障情况下，您也可以随时查看有关系统的可用统计信息。如果您需要 100% 的准确性，例如按请求计费，Prometheus 不是一个好的选择，因为收集的数据可能不够详细和完整。在这种情况下，您最好使用其他系统来收集和分析数据以进行计费，并使用 Prometheus 进行其余的监控
